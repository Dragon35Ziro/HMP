<Window x:Class="StudentAttendanceApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:StudentAttendanceApp"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        Title="Учет студентов" 
        Height="750" 
        Width="1000"
        >
    <Window.Resources>
        <DataTemplate x:Key="CheckBoxTemplate">
            <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}"/>
        </DataTemplate>
        <local:StudentIdToNameConverter x:Key="StudentIdToNameConverter"/>
        <local:IndexConverter x:Key="IndexConverter"/>
        <local:WeekTypeConverter x:Key="WeekTypeConverter"/>

        <Style TargetType="Button" x:Key="ActionButton">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Padding" Value="8 2"/>
            <Setter Property="Background" Value="#FFDDDDDD"/>
        </Style>
        <ObjectDataProvider 
            x:Key="DaysOfWeek" 
            MethodName="GetValues" 
            ObjectType="{x:Type sys:Enum}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="sys:DayOfWeek"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
    </Window.Resources>

    <TabControl>
        <!-- Вкладка групп -->
        <TabItem Header="Группы">
            <StackPanel Margin="10">
                <GroupBox Header="Управление группами">
                    <StackPanel>
                        <TextBox x:Name="GroupNameBox" Margin="5"/>
                        <Button Content="Добавить группу" 
                                Click="AddGroup_Click" 
                                Style="{StaticResource ActionButton}"/>
                        <ListBox x:Name="GroupsList" 
                                 ItemsSource="{Binding Data.Groups}"
                                 Height="150">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <DockPanel>
                                        <TextBlock Text="{Binding Name}" VerticalAlignment="Center"/>
                                        <Button Content="X" 
                                                Style="{StaticResource ActionButton}"
                                                Click="DeleteGroup_Click"/>
                                    </DockPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </StackPanel>
                </GroupBox>
            </StackPanel>
        </TabItem>

        <!-- Вкладка студентов -->
        <TabItem Header="Студенты">
            <StackPanel>
                <GroupBox Header="Управление студентами" Margin="10">
                    <StackPanel>
                        <ComboBox x:Name="StudentsGroupFilter" 
                                ItemsSource="{Binding Data.Groups}"
                                DisplayMemberPath="Name"
                                SelectedItem="{Binding SelectedStudentGroup}"
                                Margin="5"/>
                        <TextBox x:Name="StudentNameBox" Margin="5"/>
                        <Button Content="Добавить студента" 
                                Click="AddStudent_Click" 
                                Style="{StaticResource ActionButton}"/>
                        <ListBox x:Name="StudentsList" 
                                 ItemsSource="{Binding Data.Students}"
                                 Height="250">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <DockPanel>
                                        <StackPanel>
                                            <TextBlock Text="{Binding Name}" FontWeight="Bold"/>
                                            <TextBlock Text="{Binding Group.Name}" Foreground="Gray"/>
                                        </StackPanel>
                                        <Button Content="X" 
                                                Style="{StaticResource ActionButton}"
                                                Click="DeleteStudent_Click"/>
                                    </DockPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </StackPanel>
                </GroupBox>
            </StackPanel>
        </TabItem>

        <!-- Вкладка расписания -->
        <TabItem Header="Расписание">
            <StackPanel Margin="10">
                <ComboBox x:Name="ScheduleGroupCombo" 
                        ItemsSource="{Binding Data.Groups}"
                        DisplayMemberPath="Name"
                        Margin="5"
                        SelectionChanged="ScheduleGroupCombo_SelectionChanged"/>
                <ComboBox x:Name="WeekTypeCombo" 
                        Margin="5" 
                        SelectedIndex="0"
                        SelectionChanged="WeekTypeCombo_SelectionChanged">
                    <ComboBoxItem Content="Числитель"/>
                    <ComboBoxItem Content="Знаменатель"/>
                </ComboBox>
                <DataGrid x:Name="ScheduleGrid" 
                         AutoGenerateColumns="False"
                         Margin="5">
                    <DataGrid.Columns>
                        <DataGridComboBoxColumn Header="День недели"
                                            SelectedItemBinding="{Binding Day}"
                                            ItemsSource="{Binding Source={StaticResource DaysOfWeek}}"/>
                        <DataGridTextColumn Header="Количество пар" Binding="{Binding PairsCount}"/>
                        <DataGridTemplateColumn>
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Content="Удалить" 
                                            Click="DeleteScheduleDay_Click"
                                            Style="{StaticResource ActionButton}"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
                <Button Content="Добавить день" 
                        Click="AddScheduleDay_Click" 
                        Style="{StaticResource ActionButton}"/>
            </StackPanel>
        </TabItem>

        <!-- Вкладка посещаемости -->
        <TabItem Header="Посещаемость">
            <DockPanel>
                <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="10">
                    <DatePicker SelectedDate="{Binding SelectedDate, UpdateSourceTrigger=PropertyChanged}" Width="120"/>
                    <ComboBox x:Name="AttendanceGroupFilter" 
                        DisplayMemberPath="Name" 
                        Margin="10"
                        ItemsSource="{Binding Data.Groups}"
                        SelectedItem="{Binding SelectedAttendanceGroup, UpdateSourceTrigger=PropertyChanged}"/>
                    <Button Content="Сохранить" Click="SaveAttendance_Click" Margin="5"/>
                </StackPanel>

                <DataGrid x:Name="AttendanceGrid" 
                    AutoGenerateColumns="False"
                    ItemsSource="{Binding FilteredStudents}"
                    AutoGeneratingColumn="AttendanceGrid_AutoGeneratingColumn">
                    <DataGrid.Columns>
                        <DataGridTemplateColumn Width="30">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Header="Студент" Binding="{Binding Name}" Width="*"/>
                    </DataGrid.Columns>
                </DataGrid>
            </DockPanel>
        </TabItem>

        <!-- Вкладка привязки почты -->
        <TabItem Header="Привязка почты">
            <StackPanel Margin="10">
                <GroupBox Header="Привязать email">
                    <StackPanel>
                        <ComboBox x:Name="EmailStudentsCombo" 
          ItemsSource="{Binding Data.Students}"
          DisplayMemberPath="Name"
          SelectedValuePath="Id"
          Margin="5"/>
                        <TextBox x:Name="EmailTextBox" Margin="5"/>
                        <Button Content="Привязать" 
                                Click="BindEmail_Click" 
                                Style="{StaticResource ActionButton}"/>
                    </StackPanel>
                </GroupBox>
                <DataGrid x:Name="EmailMappingsGrid"
          ItemsSource="{Binding Data.EmailMappings, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
          AutoGenerateColumns="False"
          EnableRowVirtualization="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Email" Binding="{Binding Email}" Width="*"/>
                        <DataGridTextColumn Header="Студент" 
                          Binding="{Binding Student.Name, Mode=OneWay}" 
                          Width="*"/>
                    </DataGrid.Columns>
                </DataGrid>

            </StackPanel>
        </TabItem>

        <!-- Вкладка лабораторных -->
        <TabItem Header="Лабораторные">
            <StackPanel>
                <Button Content="Обновить список" 
                        Click="RefreshLabsButton_Click" 
                        Style="{StaticResource ActionButton}"/>
                <DataGrid x:Name="LabWorksGrid" 
          ItemsSource="{Binding Data.LabWorks}"
          AutoGenerateColumns="False">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Студент" 
                          Binding="{Binding StudentId, Converter={StaticResource StudentIdToNameConverter}}"/>
                        <DataGridTextColumn Header="Название" Binding="{Binding Title}"/>
                        <DataGridTemplateColumn Header="Файл">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Content="Скачать" 
                            Click="DownloadLab_Click"
                            Tag="{Binding FilePath}"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </StackPanel>
        </TabItem>

        <!-- Вкладка статистики -->
        <TabItem Header="Статистика">
            <DataGrid x:Name="StatsGrid" 
         ItemsSource="{Binding Data.Students}"
         AutoGenerateColumns="False">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Студент" Binding="{Binding Name}" Width="*"/>
                    <DataGridTextColumn Header="Группа" Binding="{Binding Group.Name}" Width="*"/>
                    <DataGridTextColumn Header="Посещено пар" 
                          Binding="{Binding TotalClassesAttended, Mode=OneWay}" 
                          Width="*"/>
                    <DataGridTextColumn Header="Сдано лаб" 
                          Binding="{Binding TotalLabsSubmitted}" 
                          Width="*"/>
                </DataGrid.Columns>
            </DataGrid>
        </TabItem>

        <!-- Вкладка почты -->
        <TabItem Header="Почта">
            <StackPanel Margin="10">
                <Button Content="Проверить почту" 
                        Click="CheckEmailButton_Click" 
                        Style="{StaticResource ActionButton}"/>
                <ProgressBar x:Name="EmailProgressBar" 
                            Height="20"
                            IsIndeterminate="True"
                            Visibility="Collapsed"/>
                <TextBlock x:Name="EmailStatusText"
                         Margin="5"
                         TextWrapping="Wrap"/>
            </StackPanel>
        </TabItem>
    </TabControl>
</Window>